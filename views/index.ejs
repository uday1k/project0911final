<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('partials/head.ejs', {title:"Index"}) %>
    <style>
        .fa,.fas{
            padding: 5px;
        }
        .card-header{
            text-align: center;
            background-color: #FEFBE7;
        }
        
        .card-footer{
            text-align: center;
            background-color: #DAEAF1;
        }
        .card-title{
            text-align: center;
        }
        .rounded-pill{
            padding: 1px;
            margin: 2px;
        }

    </style>
</head>

<body>



    <%- include('partials/navbar.ejs',{pageName:"home"}) %>

        <%- include('partials/dataAlerts.ejs') %>


            <div class="m-3">
                <form action="/" method="get">
                    <div class="row">
                        <div class="col-2">
                            <input class="form-control mr-sm-2" name="search_value" id="search_id" type="search"
                                placeholder="Search" value="<%=search_id_value%>" oninput="showHint(this.value)">
                            <ul class="list-unstyled" id="options_id">

                            </ul>
                        </div>
                        <div class="col-2">
                            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                        </div>
                    </div>
                </form>
            </div>
 <!-- p-3 my-3 border -->
 
            <div class="container">


                <%if(!(rorj.length)){%>
                    <h1 class="d-flex justify-content-center">No Results Found</h1>
                    <%}%>

                <div class="container">
                    <div class="row">

                        <% for(let i=0;i<rorj.length;i++){%>
                                    <div class="col-md-3 card mx-3 ">
                                        <div class="card-header" >
                                            <h4 class="card-title" style="text-align: center;"><%=rorj[i].companyName%></h4>
                                        </div>
                                        <div class="card-body" >
            
                                              <strong title="ctc offering"><i class="fas fa-rupee-sign"></i>  <%=rorj[i].ctcOffered%> LPA <br></strong>
            
                                                <strong title="department"><i class="fa fa-briefcase"></i> <%=rorj[i].deptType%> <br></strong>
            
                                                <strong title="Role"><i class="fas fa-network-wired"></i> <%=rorj[i].roleType%><br></strong>
                                                <strong title="Last Date on"><i class="fa fa-calendar"></i> <%=rorj[i].lastDateTimeToApply%></strong><br>
                                                <strong title="Qualification required"><i class="fas fa-user-graduate"></i> <%=rorj[i].qualificationRequired%></strong><br>
                                                &nbsp;<strong>Skills:</strong>
                                                <%if(!(rorj[i].skillsRequired)){%>
                                                    <b>No Skills required</b><br>
                                                    <%} else if(!(Array.isArray(rorj[i].skillsRequired))){%>
                                                        
                                                            <%=rorj[i].skillsRequired %>
                                                         
                                                        <%}else{ for(let j=0;j<rorj[i].skillsRequired.length;j++){%>
                                                            
                                                                <%=rorj[i].skillsRequired[j]%> &nbsp;
                                                            
                                                            <%}%>
                                                                <%}%>
                                                                
                                                
                                        </div>
                                        <a href="/view/<%=rorj[i]._id%>" target="_blank">
                                            <div class="card-footer"> More Info <i class="fas fa-arrow-circle-right"></i> </div>
                                        </a>
            
                                    </div>
                            <%}%>





                    </div>
                </div>

               

                
                        

            <div class="d-flex justify-content-center">
                <nav>
                    <ul class="pagination">
                        <%if(previous){%>
                            <li class="page-item">
                                <a class="page-link" href="<%=prevURL%>">Previous</a>
                            </li>
                            <%}else{%>
                                <li class="page-item disabled">
                                    <span class="page-link">Previous</span>
                                </li>
                                <%}%>


                                    <li class="page-item active">
                                        <span class="page-link">
                                            <%=pageNo%>
                                        </span>
                                    </li>

                                    <%if(next){%>
                                        <li class="page-item">
                                            <a class="page-link" href="<%=nextURL%>">Next</a>

                                        </li>
                                        <%}else{%>
                                            <li class="page-item disabled">
                                                <span class="page-link">Next</span>
                                            </li>
                                            <%}%>

                    </ul>
                </nav>
            </div>
            <%- include('partials/footscript.ejs') %>
                
                        


                <script>

                    function addtosearchfun(val) {
                        let currentValue = $("#search_id").val()
                        let lastIndex = currentValue.lastIndexOf(",")
                        if (lastIndex === -1) {
                            $("#search_id").val(val + ",");
                        }
                        else {
                            let chVal = currentValue.slice(0, lastIndex + 1)
                            $("#search_id").val(chVal + val + ",");
                        }
                        showHint("");

                    }

                    function showHint(str) {
                        let lastIndexofStr = str.lastIndexOf(",")
                        let searchVal = str.slice(lastIndexofStr + 1,)

                        if (str.length == 0 || searchVal.length == 0) {
                            $("#options_id").html("");
                            return;
                        }
                        else if (str[-1] == ',') {
                            $("#options_id").html("");
                            return;
                        }
                        else {
                            $.ajax({
                                url: "/gethints",
                                type: "POST",
                                contentType: "application/json",
                                data: JSON.stringify([searchVal]),
                                cache: false,
                                processData: false,
                                success: function (msg) {

                                    var availableSkills = ""
                                    for (let i = 0; i < msg.length; i++) {
                                        availableSkills += `<li><input class="form-control mr-sm-2" value=${msg[i]} onclick=addtosearchfun(this.value) readonly></li>`
                                    }
                                    $("#options_id").html(availableSkills);

                                }
                            });
                        }
                    }
                </script>



</body>

</html>