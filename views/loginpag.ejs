<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('partials/head.ejs', {title:"Login!"}) %>
</head>
<body >

  <%- include('partials/navbar.ejs',{pageName:"login"}) %>
    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <!-- left column -->
          <div class="col-md-12">
            <!-- jquery validation -->
            <div class="card card-primary">
              
              <!-- form start -->
              <form id="quickForm" action="/validatelogin" method="post">
                <div class="card-body">
                 <div id="email_exist_id" style="display: none;">
                      <div class="d-flex justify-content-center mt-2">
                        <div class="w-25 d-flex justify-content-center alert alert-danger">
                            <strong>Email Not Found!</strong>
                        </div>
                      </div>
                  </div>
                  <div id="incorrect_password_id" style="display: none;">
                    <div class="d-flex justify-content-center mt-2">
                      <div class="w-25 d-flex justify-content-center alert alert-danger">
                          <strong>Incorrect Password!</strong>
                      </div>
                    </div>
                </div>
                <div id="not_approved_id" style="display: none;">
                  <div class="d-flex justify-content-center mt-2">
                    <div class="w-25 d-flex justify-content-center alert alert-danger">
                        <strong>Not Approved!</strong>
                    </div>
                  </div>
              </div>
                  <%if(colorOfSpan){%>
                  <span id="loginCheckId" style="color:red ;"><%=loginCheckDet%></span>
                  <%}else{%>
                    <span id="loginCheckId" style="color:green ;"><%=loginCheckDet%></span>
                    <%}%>
                  <div class="form-group">
                    <label for="id_email">Email</label>
                    <input type="text" name="login_email" class="form-control" id="id_email" placeholder="Enter email">
                  </div>
                  <div class="form-group">
                    <label for="id_password">Password</label>
                    <input type="password" name="login_password" class="form-control" id="id_password" placeholder="Enter Password">
                  </div>
                  <div class="form-group mb-0">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" name="terms" class="custom-control-input" id="exampleCheck1">
                      <label class="custom-control-label" for="exampleCheck1">I agree to the <a href="#">terms of service</a>.</label>
                    </div>
                  </div>
                </div>
                <!-- /.card-body -->
                <div class="card-footer">
                  <button type="submit" class="btn btn-primary">Submit</button>
                  <!--<a class="btn btn-primary" href="/">Register ?</a>-->
                </div>
              </form>
            </div>
            <!-- /.card -->
            </div>
         
          <div class="col-md-6">

          </div>
          <!--/.col (right) -->
        </div>
        <!-- /.row -->
      </div><!-- /.container-fluid -->
    </section>
    
  

  

  <%- include('partials/footscript.ejs') %>

<!-- Page specific script -->
<script>
$(function () {
    $.validator.setDefaults({
          submitHandler: function (form) {
            let formData = $("#quickForm").serializeArray();
            $.ajax({
              url: "/checklogin", 
              type: "POST",
              contentType: "application/json",             
              data: JSON.stringify(formData),
              cache: false,             
              processData: false,      
              success: function(data) {
                if(data==="emailNotFound"){
                  $("#email_exist_id").fadeTo(2000, 500).slideUp(500, function(){
                          $("#email_exist_id").slideUp(500);
                      });
                }
                else if(data==="incorrectPassword"){
                  $("#incorrect_password_id").fadeTo(2000, 500).slideUp(500, function(){
                          $("#incorrect_password_id").slideUp(500);
                      });
                }
                else if(data==="notApproved"){
                  $("#not_approved_id").fadeTo(2000, 500).slideUp(500, function(){
                          $("#not_approved_id").slideUp(500);
                      });
                }
                else{
                  $("#email_exist_id").hide();
                  $("#incorrect_password_id").hide();
                  $("#not_approved_id_id").hide();
                  form.submit();
                  
                }
              }
          });
         
    
          }
      });
    
  $('#quickForm').validate({
    rules: {
      login_email: {
        required: true,
        email:true,
      },
      login_password: {
        required: true,
        minlength: 8,
      },
      terms: {
        required: true
      },
    },
    messages: {
      login_email: {
        required: "Please enter email address",
        email: "Please enter a valid email address"
      },
      login_password: {
        required: "Please provide a password",
        minlength: "Your password must be at least 8 characters long"
      },
      terms: "Please accept our terms"
    },
    errorElement: 'span',
    errorPlacement: function (error, element) {
      error.addClass('invalid-feedback');
      element.closest('.form-group').append(error);
    },
    highlight: function (element, errorClass, validClass) {
      $(element).addClass('is-invalid');
    },
    unhighlight: function (element, errorClass, validClass) {
      $(element).removeClass('is-invalid');
    }
  });
});
</script>
</body>
</html>
